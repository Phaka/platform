name: Red Hat Enterprise Linux
version: "6.10"
architecture: i386
release: "6"
downloads:
    - https://developers.redhat.com/content-gateway/file/rhel-server-6.10-i386-dvd.iso
documentation: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6
hardware:
    memory: 2048
    storage: 8192
    processors:
        count: 1
        cores: 1
boot:
    http:
        commands: <tab> inst.text inst.ks={{ .ServerUrl }}/ks.cfg<enter><wait>
        files:
            ks.cfg.pkrtpl.hcl: |-
                # Kickstart file automatically generated by anaconda.

                #version=DEVEL
                install
                cdrom
                lang ${ locale }
                keyboard us
                network --onboot yes --device eth0 --bootproto dhcp
                rootpw  --iscrypted ${ password_hashed }
                firewall --service=ssh
                authconfig --enableshadow --passalgo=sha512
                selinux --enforcing
                timezone --utc ${ timezone }

                firstboot --disable
                reboot

                bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"
                logging --level=info
                zerombr

                clearpart --drives=sda --all --initlabel
                ignoredisk --only-use=sda
                part /boot --fstype=ext4 --size=500
                part pv.008002 --grow --size=1
                volgroup vg_oraclelinux6amd64 --pesize=4096 pv.008002
                logvol / --fstype=ext4 --name=lv_root --vgname=vg_oraclelinux6amd64 --grow --size=1024 --maxsize=51200
                logvol swap --name=lv_swap --vgname=vg_oraclelinux6amd64 --grow --size=1638 --maxsize=1638

                %packages
                @core
                @server-policy
                -ql23xx-firmware
                -netxen-firmware
                -bfa-firmware
                -rt73usb-firmware
                -iwl5150-firmware
                -iwl100-firmware
                -iwl6050-firmware
                -iwl6000g2a-firmware
                -ql2200-firmware
                -iwl3945-firmware
                -rt61pci-firmware
                -iwl4965-firmware
                -ql2500-firmware
                -iwl6000-firmware
                -libertas-usb8388-firmware
                -ivtv-firmware
                -ql2100-firmware
                -iwl5000-firmware
                -ql2400-firmware
                -iwl1000-firmware
                -kernel-firmware
                openssh-server
                nano
                %end

                %post --log=/root/registration_results.out
                subscription-manager register --org=${ subscription_organization } --activationkey=${ subscription_key }
                subscription-manager repos --enable=rhel-6-server-optional-rpms

                sed -i 's/^#?PermitRootLogin \(without-password\|forced-commands-only\|prohibit-password\|no\|yes\)/PermitRootLogin yes/' /etc/ssh/sshd_config

                wget https://archives.fedoraproject.org/pub/archive/epel/6/x86_64/epel-release-6-8.noarch.rpm
                rpm -Uvh epel-release-6*.rpm
                yum update -y
                yum install -y open-vm-tools
                %end
        delay: 5s
        variables:
            - name: locale
            - name: password_hashed
            - name: timezone
            - name: subscription_organization
            - name: subscription_key
hypervisors:
    vsphere:
        guest_os_type: otherGuest
        disk_controller_type: pvscsi
        network_adapter_type: vmxnet3
        firmware: bios
